<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"liuaoao.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":false,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Makefile 概述 makefile 是一种用于自动化编译和构建程序的脚本文件，特别是在Unix-like系统中。它定义了如何将源代码编译成可执行文件或其他目标文件。通过 make 工具读取 Makefile 中的规则，自动处理源文件的依赖关系和编译顺序，从而简化和自动化了构建过程。 编译与链接 在编译过程中，源文件（如 .c 文件）会被编译成中间目标文件（在Unix下是 .o 文件）。这个">
<meta property="og:type" content="article">
<meta property="og:title" content="深入理解Makefile">
<meta property="og:url" content="https://liuaoao.top/archives/d5c3c62.html">
<meta property="og:site_name" content="白茶不雨的博客">
<meta property="og:description" content="Makefile 概述 makefile 是一种用于自动化编译和构建程序的脚本文件，特别是在Unix-like系统中。它定义了如何将源代码编译成可执行文件或其他目标文件。通过 make 工具读取 Makefile 中的规则，自动处理源文件的依赖关系和编译顺序，从而简化和自动化了构建过程。 编译与链接 在编译过程中，源文件（如 .c 文件）会被编译成中间目标文件（在Unix下是 .o 文件）。这个">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-09-01T08:54:05.000Z">
<meta property="article:modified_time" content="2024-09-01T08:56:20.297Z">
<meta property="article:author" content="白茶不雨">
<meta property="article:tag" content="makefile">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://liuaoao.top/archives/d5c3c62.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css">
  <title>深入理解Makefile | 白茶不雨的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">白茶不雨的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">世间所有的相遇，都是久别重逢</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">49</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">41</span></a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>links</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    

  <a href="https://github.com/Humble-LiuAo" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener external nofollow noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liuaoao.top/archives/d5c3c62.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="白茶不雨">
      <meta itemprop="description" content="种一棵树最好的时间是十年前，其次是现在！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白茶不雨的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          深入理解Makefile
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-09-01 16:54:05 / 修改时间：16:56:20" itemprop="dateCreated datePublished" datetime="2024-09-01T16:54:05+08:00">2024-09-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">开发工具</span></a>
                </span>
            </span>

          
            <span id="/archives/d5c3c62.html" class="post-meta-item leancloud_visitors" data-flag-title="深入理解Makefile" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/d5c3c62.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/d5c3c62.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <meta name="referrer" content="no-referrer" />
<h2 id="Makefile-概述">Makefile 概述</h2>
<p><strong>makefile</strong> 是一种用于自动化编译和构建程序的脚本文件，特别是在Unix-like系统中。它定义了如何将源代码编译成可执行文件或其他目标文件。通过 <code>make</code> 工具读取 Makefile 中的规则，自动处理源文件的依赖关系和编译顺序，从而简化和自动化了构建过程。</p>
<h3 id="编译与链接">编译与链接</h3>
<p>在编译过程中，源文件（如 <code>.c</code> 文件）会被编译成中间目标文件（在Unix下是 <code>.o</code> 文件）。这个步骤称为编译。编译器检查语法和声明，生成目标文件。如果源文件包含函数或变量的声明而没有定义，编译器会发出警告，但仍会生成目标文件。</p>
<span id="more"></span>
<p>链接过程将所有目标文件（<code>.o</code> 文件）合并成一个最终的可执行文件。在链接时，链接器负责解决函数和变量的实际定义，并检查是否所有的引用都有对应的实现。如果链接器找不到某个函数的实现，就会报错。</p>
<h3 id="Make的作用">Make的作用</h3>
<p><code>make</code> 是一个自动化构建工具，通过读取 Makefile，<code>make</code> 能够自动处理文件的依赖关系，执行编译和链接命令。它可以减少手动编译的繁琐步骤，提高开发效率。在开发大型工程时，编写 Makefile 让 <code>make</code> 工具管理编译过程，可以大大简化构建流程。</p>
<p>Makefile 的好处包括：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>自动化编译</strong>：只需运行 <code>make</code> 命令，即可自动编译整个工程。</p>
</li>
<li class="lvl-2">
<p><strong>依赖管理</strong>：自动处理文件间的依赖关系，确保只有在源文件修改后才重新编译相关的目标文件。</p>
</li>
<li class="lvl-2">
<p><strong>提高效率</strong>：避免了重复编译和手动管理编译过程的麻烦。</p>
</li>
</ul>
<h2 id="Makefile介绍">Makefile介绍</h2>
<p>makefile来告诉make命令如何编译和链接这几个文件。我们的规则是：</p>
<ol>
<li class="lvl-3">
<p>如果这个工程没有编译过，那么我们的所有c文件都要编译并被链接。</p>
</li>
<li class="lvl-3">
<p>如果这个工程的某几个c文件被修改，那么我们只编译被修改的c文件，并链接目标程序。</p>
</li>
<li class="lvl-3">
<p>如果这个工程的头文件被改变了，那么我们需要编译引用了这几个头文件的c文件，并链接目标程序。</p>
</li>
</ol>
<p>只要我们的makefile写得够好，所有的这一切，我们只用一个make命令就可以完成，make命令会自动智能地根据当前的文件修改的情况来确定哪些文件需要重编译，从而自动编译所需要的文件和链接目标程序。</p>
<h3 id="Makefile内容">Makefile内容</h3>
<p>Makefile里主要包含了五个东西：显式规则、隐式规则、变量定义、指令和注释。</p>
<ol>
<li class="lvl-3">
<p>显式规则。显式规则说明了如何生成一个或多个目标文件。这是由Makefile的书写者明显指出要生成的文件、文件的依赖文件和生成的命令。</p>
</li>
<li class="lvl-3">
<p>隐式规则。由于我们的make有自动推导的功能，所以隐式规则可以让我们比较简略地书写Makefile，这是由make所支持的。</p>
</li>
<li class="lvl-3">
<p>变量的定义。在Makefile中我们要定义一系列的变量，变量一般都是字符串，这个有点像你C语言中的宏，当Makefile被执行时，其中的变量都会被扩展到相应的引用位置上。</p>
</li>
<li class="lvl-3">
<p>指令。其包括了三个部分，一个是在一个Makefile中引用另一个Makefile，就像C语言中的include一样；另一个是指根据某些情况指定Makefile中的有效部分，就像C语言中的预编译#if一样；还有就是定义一个多行的命令。有关这一部分的内容，我会在后续的部分中讲述。</p>
</li>
<li class="lvl-3">
<p>注释。Makefile中只有行注释，和UNIX的Shell脚本一样，其注释是用 <code>#</code> 字符，这个就像C/C++中的 <code>//</code> 一样。如果你要在你的Makefile中使用 <code>#</code> 字符，可以用反斜杠进行转义，如： <code>\#</code> 。</p>
</li>
</ol>
<p>值得一提的是，在Makefile中的命令，必须要以 <code>Tab</code> 键开始。</p>
<h3 id="Make的工作方式">Make的工作方式</h3>
<p>GNU的make工作时的执行步骤如下：</p>
<ol>
<li class="lvl-3">
<p>读入所有的Makefile。</p>
</li>
<li class="lvl-3">
<p>读入被include的其它Makefile。</p>
</li>
<li class="lvl-3">
<p>初始化文件中的变量。</p>
</li>
<li class="lvl-3">
<p>推导隐式规则，并分析所有规则。</p>
</li>
<li class="lvl-3">
<p>为所有的目标文件创建依赖关系链。</p>
</li>
<li class="lvl-3">
<p>根据依赖关系，决定哪些目标要重新生成。</p>
</li>
<li class="lvl-3">
<p>执行生成命令。</p>
</li>
</ol>
<p>1-5步为第一个阶段，6-7为第二个阶段。第一个阶段中，如果定义的变量被使用了，那么，make会把其展开在使用的位置。但make并不会完全马上展开，make使用的是拖延战术，如果变量出现在依赖关系的规则中，那么仅当这条依赖被决定要使用了，变量才会在其内部展开。</p>
<h3 id="Makefile中使用变量">Makefile中使用变量</h3>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">edit : main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br><span class="line">    cc -o edit main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br><span class="line"></span><br><span class="line">main.o : main.c defs.h</span><br><span class="line">    cc -c main.c</span><br><span class="line">kbd.o : kbd.c defs.h command.h</span><br><span class="line">    cc -c kbd.c</span><br><span class="line">command.o : command.c defs.h command.h</span><br><span class="line">    cc -c command.c</span><br><span class="line">display.o : display.c defs.h buffer.h</span><br><span class="line">    cc -c display.c</span><br><span class="line">insert.o : insert.c defs.h buffer.h</span><br><span class="line">    cc -c insert.c</span><br><span class="line">search.o : search.c defs.h buffer.h</span><br><span class="line">    cc -c search.c</span><br><span class="line">files.o : files.c defs.h buffer.h command.h</span><br><span class="line">    cc -c files.c</span><br><span class="line">utils.o : utils.c defs.h</span><br><span class="line">    cc -c utils.c</span><br><span class="line">clean :</span><br><span class="line">    rm edit main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br></pre></td></tr></table></figure>
<p>反斜杠（ <code>\</code> ）是换行符的意思。</p>
<p>声明一个变量，叫 <code>objects</code> ， <code>OBJECTS</code> ， <code>objs</code> ， <code>OBJS</code> ， <code>obj</code> 或是 <code>OBJ</code> ，反正不管什么啦，只要能够表示obj文件就行了。我们在makefile一开始就这样定义：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects = main.o kbd.o command.o display.o \</span><br><span class="line">     insert.o search.o files.o utils.o</span><br></pre></td></tr></table></figure>
<p>改良版makefile就变成下面这个样子：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects = main.o kbd.o command.o display.o \</span><br><span class="line">    insert.o search.o files.o utils.o</span><br><span class="line"></span><br><span class="line">edit : <span class="variable">$(objects)</span></span><br><span class="line">    cc -o edit <span class="variable">$(objects)</span></span><br><span class="line">main.o : main.c defs.h</span><br><span class="line">    cc -c main.c</span><br><span class="line">kbd.o : kbd.c defs.h command.h</span><br><span class="line">    cc -c kbd.c</span><br><span class="line">command.o : command.c defs.h command.h</span><br><span class="line">    cc -c command.c</span><br><span class="line">display.o : display.c defs.h buffer.h</span><br><span class="line">    cc -c display.c</span><br><span class="line">insert.o : insert.c defs.h buffer.h</span><br><span class="line">    cc -c insert.c</span><br><span class="line">search.o : search.c defs.h buffer.h</span><br><span class="line">    cc -c search.c</span><br><span class="line">files.o : files.c defs.h buffer.h command.h</span><br><span class="line">    cc -c files.c</span><br><span class="line">utils.o : utils.c defs.h</span><br><span class="line">    cc -c utils.c</span><br><span class="line">clean :</span><br><span class="line">    rm edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<p>如果有新的 <code>.o</code> 文件加入，只需简单地修改一下 <code>object</code></p>
<h3 id="让Make自动推导">让Make自动推导</h3>
<p>GNU Make 具有强大的隐式规则功能，可以自动推导文件之间的依赖关系及其对应的构建命令。这样，你无需为每个目标文件明确指定构建命令，Make 可以自动处理这些任务。</p>
<h4 id="隐式规则的工作原理">隐式规则的工作原理</h4>
<ol>
<li class="lvl-3">
<p><strong>自动推导依赖</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5">GNU Make 能够自动推导 <code>.o</code> 文件的生成规则。比如，它知道 <code>.o</code> 文件通常由同名的 <code>.c</code> 文件编译生成。</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>自动生成命令</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5">当 Make 发现一个 <code>.o</code> 文件时，它会自动将 <code>.c</code> 文件作为依赖，并使用类似 <code>cc -c whatever.c</code> 的命令进行编译。</li>
</ul>
</li>
</ol>
<h4 id="简化后的-Makefile-示例">简化后的 Makefile 示例</h4>
<p>使用 GNU Make 的隐式规则，可以简化 Makefile，避免为每个目标文件都写上类似的命令。以下是一个简化后的 Makefile 示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">makefileCopy code<span class="comment"># 定义目标文件</span></span><br><span class="line">objects = main.o kbd.o command.o display.o \</span><br><span class="line">    insert.o search.o files.o utils.o</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义最终目标</span></span><br><span class="line"><span class="section">edit: <span class="variable">$(objects)</span></span></span><br><span class="line">    cc -o edit <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定头文件依赖（不再需要显式的编译规则）</span></span><br><span class="line"><span class="section">main.o: defs.h</span></span><br><span class="line"><span class="section">kbd.o: defs.h command.h</span></span><br><span class="line"><span class="section">command.o: defs.h command.h</span></span><br><span class="line"><span class="section">display.o: defs.h buffer.h</span></span><br><span class="line"><span class="section">insert.o: defs.h buffer.h</span></span><br><span class="line"><span class="section">search.o: defs.h buffer.h</span></span><br><span class="line"><span class="section">files.o: defs.h buffer.h command.h</span></span><br><span class="line"><span class="section">utils.o: defs.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义伪目标</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理规则</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<p><strong>另一种的写法</strong></p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects = main.o kbd.o command.o display.o \</span><br><span class="line">    insert.o search.o files.o utils.o</span><br><span class="line"></span><br><span class="line">edit : <span class="variable">$(objects)</span></span><br><span class="line">    cc -o edit <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(objects)</span> : defs.h</span><br><span class="line">kbd.o command.o files.o : command.h</span><br><span class="line">display.o insert.o search.o files.o : buffer.h</span><br><span class="line"></span><br><span class="line">.PHONY : clean</span><br><span class="line">clean :</span><br><span class="line">    rm edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<h3 id="清空目录的规则">清空目录的规则</h3>
<p>每个Makefile中都应该写一个清空目标文件（ <code>.o</code> ）和可执行文件的规则，这不仅便于重编译，也很利于保持文件的清洁。</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">.PHONY : clean</span><br><span class="line">clean :</span><br><span class="line">    -rm edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<h3 id="包含其它Makefile">包含其它Makefile</h3>
<p>在 Makefile 中，<code>include</code> 指令用于将其他 Makefile 的内容包含到当前 Makefile 中。这种机制类似于 C 语言中的 <code>#include</code> 指令。通过 <code>include</code>，你可以将多个 Makefile 文件的内容合并到一个主 Makefile 中，从而实现代码的重用和组织。</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> &lt;filenames&gt;...</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>&lt;filenames&gt;</code> 可以是当前操作系统 Shell 的文件模式，包括路径和通配符。</p>
</li>
<li class="lvl-2">
<p><code>include</code> 前面可以有空格，但不能使用 Tab 键开始。</p>
</li>
<li class="lvl-2">
<p><code>include</code> 和 <code>&lt;filenames&gt;</code> 之间可以用一个或多个空格隔开。</p>
</li>
</ul>
<p>假设你有以下 Makefile 文件：<code>a.mk</code>、<code>b.mk</code>、<code>c.mk</code>，以及一个文件 <code>foo.make</code>，还有一个变量 <code>$(bar)</code>，其包含了 <code>bish</code> 和 <code>bash</code>，那么以下语句：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> foo.make *.mk <span class="variable">$(bar)</span></span><br></pre></td></tr></table></figure>
<p>等价于：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> foo.make a.mk b.mk c.mk bish bash</span><br></pre></td></tr></table></figure>
<h4 id="寻找文件的路径">寻找文件的路径</h4>
<p><code>make</code> 在处理 <code>include</code> 指令时，会按照以下顺序查找文件：</p>
<ol>
<li class="lvl-3">
<p><strong>当前目录</strong>：首先在当前目录下查找指定的文件。</p>
</li>
<li class="lvl-3">
<p><strong>指定的目录</strong>：如果使用了 <code>-I</code> 或 <code>--include-dir</code> 参数，则会在这些目录下查找。</p>
</li>
<li class="lvl-3">
<p><strong>默认目录</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5"><code>&lt;prefix&gt;/include</code>（如 <code>/usr/local/bin</code>）</li>
<li class="lvl-5"><code>/usr/gnu/include</code></li>
<li class="lvl-5"><code>/usr/local/include</code></li>
<li class="lvl-5"><code>/usr/include</code></li>
</ul>
</li>
</ol>
<p>环境变量 <code>.INCLUDE_DIRS</code> 也会影响 <code>make</code> 查找的目录列表。避免使用 <code>-I</code> 参数覆盖默认目录，以免使 <code>make</code> 忘记已设定的包含目录。</p>
<h4 id="错误处理">错误处理</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>如果指定的文件无法找到，<code>make</code> 会发出警告，但不会立即终止执行。</p>
</li>
<li class="lvl-2">
<p><code>make</code> 会继续处理其他文件，直到完成 Makefile 的读取。如果无法找到文件或读取失败，<code>make</code> 才会报致命错误。</p>
</li>
<li class="lvl-2">
<p>要忽略无法读取的文件并继续执行，可以使用减号 <code>-</code>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">-include</span> &lt;filenames&gt;...</span><br></pre></td></tr></table></figure>
<p>或者为了兼容其他 <code>make</code> 版本，可以使用 <code>sinclude</code> 代替 <code>-include</code>。：</p>
</li>
</ul>
<h3 id="环境变量MAKEFILES">环境变量MAKEFILES</h3>
<p>在使用 <code>make</code> 工具时，环境变量 <code>MAKEFILES</code> 可以指定一系列 Makefile 文件，这些文件的内容会在执行 <code>make</code> 时被自动引入。该变量中的值是由空格分隔的多个 Makefile 文件名。这种行为类似于 <code>include</code> 指令。</p>
<ol>
<li class="lvl-3">
<p><strong>自动引入</strong>：<code>make</code> 会将 <code>MAKEFILES</code> 环境变量中指定的文件内容自动包含进来，就像在 Makefile 中使用 <code>include</code> 指令一样。</p>
</li>
<li class="lvl-3">
<p><strong>默认目标忽略</strong>：从 <code>MAKEFILES</code> 环境变量引入的 Makefile 文件中的“默认目标”不会被执行。</p>
</li>
<li class="lvl-3">
<p><strong>错误忽略</strong>：如果指定的文件存在错误，<code>make</code> 不会中断执行，而是继续处理其他文件或目标。</p>
</li>
</ol>
<p>如果环境变量 <code>MAKEFILES</code> 设置为：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> MAKEFILES=<span class="string">&quot;common.mk utilities.mk&quot;</span></span><br></pre></td></tr></table></figure>
<p>那么 <code>make</code> 在执行时会自动将 <code>common.mk</code> 和 <code>utilities.mk</code> 中的内容包含进来。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>全局影响</strong>：一旦定义了 <code>MAKEFILES</code> 环境变量，所有的 <code>make</code> 执行都会受到这些文件的影响。这可能导致意外的行为或难以追踪的错误。</p>
</li>
<li class="lvl-2">
<p><strong>调试</strong>：如果遇到 Makefile 的异常行为，检查是否定义了 <code>MAKEFILES</code> 环境变量，并确保其内容正确。</p>
</li>
<li class="lvl-2">
<p><strong>避免使用</strong>：通常不建议使用 <code>MAKEFILES</code> 环境变量，因为它会影响所有 <code>make</code> 的执行过程。为避免混淆和难以追踪的错误，最好在 Makefile 中显式使用 <code>include</code> 指令来包含其他 Makefile 文件。</p>
</li>
<li class="lvl-2">
<p><strong>检查</strong>：在调试 Makefile 问题时，检查环境变量以确认是否有定义 <code>MAKEFILES</code>，以帮助识别潜在的问题来源。</p>
</li>
</ul>
<h3 id="Makefile文件名">Makefile文件名</h3>
<p>默认情况下，<code>make</code> 命令会按以下顺序在当前目录下寻找 Makefile 文件：</p>
<ol>
<li class="lvl-3">
<p><code>GNUmakefile</code></p>
</li>
<li class="lvl-3">
<p><code>makefile</code></p>
</li>
<li class="lvl-3">
<p><code>Makefile</code></p>
</li>
</ol>
<p>建议使用 <code>Makefile</code> 作为文件名，因为它在排序上靠近其他重要文件（如 <code>README</code>）。<code>GNUmakefile</code> 文件名仅被 GNU make 支持，其他版本的 make 可能不识别。</p>
<p>你也可以使用其他文件名，如 <code>Make.Solaris</code> 或 <code>Make.Linux</code>。要指定特定的 Makefile，可以使用 <code>-f</code> 或 <code>--file</code> 参数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make -f Make.Solaris</span><br><span class="line">make --file Make.Linux</span><br></pre></td></tr></table></figure>
<p>可以使用多个 <code>-f</code> 或 <code>--file</code> 参数来指定多个 Makefile。</p>
<h2 id="书写规则">书写规则</h2>
<h3 id="语法">语法</h3>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">target ... : prerequisites ...</span><br><span class="line">    recipe</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>target</p>
<p>可以是一个object file（目标文件），也可以是一个可执行文件，还可以是一个标签（label）。</p>
</li>
<li class="lvl-2">
<p>prerequisites</p>
<p>生成该target所依赖的文件和/或target。</p>
</li>
<li class="lvl-2">
<p>recipe</p>
<p>该target要执行的命令（任意的shell命令）。</p>
</li>
</ul>
<h3 id="通配符">通配符</h3>
<p>make支持三个通配符： <code>*</code> ， <code>?</code> 和 <code>~</code> 。这是和Unix的B-Shell是相同的。</p>
<p>波浪号（ <code>~</code> ）字符在文件名中也有比较特殊的用途。如果是 <code>~/test</code> ，这就表示当前用户的 <code>$HOME</code> 目录下的test目录。而 <code>~hchen/test</code> 则表示用户hchen的宿主目录下的test 目录。</p>
<ol>
<li class="lvl-3">
<p><strong><code>*</code> (星号)</strong>: 匹配任意数量的字符<br>
删除所有以 <code>.o</code> 结尾的文件</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f *.o</span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p><strong><code>?</code> (问号)</strong>: 匹配单个字符<br>
匹配所有文件名为单个字符后加 <code>.c</code> 的文件</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">compile:</span></span><br><span class="line">    gcc -o output ?.c</span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p><strong><code>~</code> (波浪号)</strong>: 表示当前用户的 <code>$HOME</code> 目录<br>
进入用户主目录下的 <code>test</code> 目录</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">gohome:</span></span><br><span class="line">    cd ~/test</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="文件搜寻">文件搜寻</h3>
<p>Makefile中可以通过<code>VPATH</code>和<code>vpath</code>关键字设置文件搜索路径：</p>
<ol>
<li class="lvl-3">
<p><strong>VPATH</strong>: 指定全局搜索目录，多个目录用冒号分隔。</p>
<p>“src”和“…/headers”，make会按照这个顺序进行搜索</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">VPATH = src:../headers</span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p><strong>vpath</strong>: 更灵活，支持为不同类型的文件指定不同的搜索目录</p>
<p>使用方法有三种：</p>
<ul class="lvl-2">
<li class="lvl-5">
<p><code>vpath &lt;pattern&gt; &lt;directories&gt;</code></p>
<p>为符合模式<pattern>的文件指定搜索目录<directories>。</p>
</li>
<li class="lvl-5">
<p><code>vpath &lt;pattern&gt;</code></p>
<p>清除符合模式<pattern>的文件的搜索目录。</p>
</li>
<li class="lvl-5">
<p><code>vpath</code></p>
<p>清除所有已被设置好了的文件搜索目录。</p>
</li>
</ul>
<p>vpath使用方法中的<pattern>需要包含 <code>%</code> 字符。 <code>%</code> 的意思是匹配零或若干字符，（需引用 <code>%</code> ，使用 <code>\</code> ）例如， <code>%.h</code> 表示所有以 <code>.h</code> 结尾的文件</p>
<p>要求make在“…/headers”目录下搜索所有以 .h 结尾的文件</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vpath</span> %.h ../headers</span><br><span class="line"><span class="keyword">vpath</span> %.c src</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="伪目标">伪目标</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>伪目标只是一个标签，通常用于Makefile中没有依赖文件的目标。伪目标不会生成实际的文件，只有在用<code>make</code>命令显式调用时才会执行。</p>
</li>
<li class="lvl-2">
<p>例如，<code>clean</code>是一个常见的伪目标，用于清理生成的文件。因为伪目标本身不生成文件，所以当目录下有与伪目标同名的文件时，执行<code>make</code>命令会出现错误。这时，我们可以使用伪目标来避免冲突。</p>
</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">SRC = <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line">OBJ = <span class="variable">$(<span class="built_in">patsubst</span> %.c, %.o, <span class="variable">$(SRC)</span>)</span></span><br><span class="line"> </span><br><span class="line"><span class="section">ALL: hello.out</span></span><br><span class="line"> </span><br><span class="line"><span class="section">hello.out: <span class="variable">$(OBJ)</span></span></span><br><span class="line">        gcc <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$(OBJ)</span>: <span class="variable">$(SRC)</span></span><br><span class="line">        gcc -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"> </span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">        rm -rf <span class="variable">$(OBJ)</span> hello.out</span><br><span class="line"> </span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean ALL</span></span><br></pre></td></tr></table></figure>
<p>通常也会把ALL设置成伪目标</p>
<h3 id="多目标">多目标</h3>
<p>Makefile的规则中的目标可以不止一个，其支持多目标</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">bigoutput littleoutput : text.g</span><br><span class="line">    generate text.g -<span class="variable">$(<span class="built_in">subst</span> output,,<span class="variable">$@</span>)</span> &gt; <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>上述规则等价于：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">bigoutput : text.g</span><br><span class="line">    generate text.g -big &gt; bigoutput</span><br><span class="line">littleoutput : text.g</span><br><span class="line">    generate text.g -little &gt; littleoutput</span><br></pre></td></tr></table></figure>
<p>其中， <code>-$(subst output,,$@)</code> 中的 <code>$</code> 表示执行一个Makefile的函数，函数名为subst，后面的为参数。关于函数，将在后面讲述。这里的这个函数是替换字符串的意思， <code>$@</code> 表示目标的集合，就像一个数组， <code>$@</code> 依次取出目标，并执于命令。</p>
<h3 id="静态模式">静态模式</h3>
<p>静态模式规则是Makefile中的一个强大特性，用于简化多目标文件的规则定义。它使得我们能够为一组目标文件定义共同的编译规则，从而避免重复书写相似的规则。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;targets ...&gt; : &lt;target-pattern&gt; : &lt;prereq-patterns ...&gt;</span><br><span class="line">    &lt;commands&gt;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>&lt;targets ...&gt;</code></strong>: 定义了一系列目标文件，可以使用通配符来匹配多个目标文件。</p>
</li>
<li class="lvl-2">
<p><strong><code>&lt;target-pattern&gt;</code></strong>: 目标模式，指定目标文件的名称模式。通常使用 <code>%</code> 表示通配符。</p>
</li>
<li class="lvl-2">
<p><strong><code>&lt;prereq-patterns ...&gt;</code></strong>: 依赖模式，指定依赖文件的名称模式。通常使用 <code>%</code> 来与目标模式进行匹配。</p>
</li>
<li class="lvl-2">
<p><strong><code>&lt;commands&gt;</code></strong>: 执行的命令，用于生成目标文件。</p>
</li>
</ul>
<p><strong>示例一</strong></p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects = foo.o bar.o</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(objects)</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(objects)</span>: %.o: %.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展后的规则等价于：</span></span><br><span class="line">foo.o : foo.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> foo.c -o foo.o</span><br><span class="line">bar.o : bar.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> bar.c -o bar.o</span><br></pre></td></tr></table></figure>
<p><strong>示例二</strong></p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">files = foo.elc bar.o lose.o</span><br><span class="line"></span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %.o,<span class="variable">$(files)</span>)</span>: %.o: %.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %.elc,<span class="variable">$(files)</span>)</span>: %.elc: %.el</span><br><span class="line">    emacs -f batch-byte-compile <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li class="lvl-3">
<p><strong><code>$(filter %.o,$(files))</code></strong>:</p>
<ul class="lvl-2">
<li class="lvl-5"><code>filter</code> 函数过滤 <code>files</code> 列表，得到 <code>.o</code> 文件（<code>bar.o</code> 和 <code>lose.o</code>）。</li>
<li class="lvl-5">对这些 <code>.o</code> 文件应用规则 <code>%.o: %.c</code>，即每个 <code>.o</code> 文件由相应的 <code>.c</code> 文件生成。</li>
</ul>
</li>
<li class="lvl-3">
<p><strong><code>$(filter %.elc,$(files))</code></strong>:</p>
<ul class="lvl-2">
<li class="lvl-5"><code>filter</code> 函数过滤 <code>files</code> 列表，得到 <code>.elc</code> 文件（<code>foo.elc</code>）。</li>
<li class="lvl-5">对这些 <code>.elc</code> 文件应用规则 <code>%.elc: %.el</code>，即每个 <code>.elc</code> 文件由相应的 <code>.el</code> 文件生成。</li>
</ul>
</li>
</ol>
<p>扩展后的规则等价于：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">bar.o : bar.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> bar.c -o bar.o</span><br><span class="line">lose.o : lose.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> lose.c -o lose.o</span><br><span class="line">foo.elc : foo.el</span><br><span class="line">    emacs -f batch-byte-compile foo.el</span><br></pre></td></tr></table></figure>
<h3 id="自动生成依赖性">自动生成依赖性</h3>
<p>在大型工程中，手动维护头文件的依赖关系是一项繁琐且容易出错的工作。为了简化这一过程，我们可以利用编译器的自动依赖生成功能。</p>
<p>大多数 C/C++ 编译器都支持 <code>-M</code> 选项来自动找寻源文件中包含的头文件并生成依赖关系。例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -MM main.c</span><br></pre></td></tr></table></figure>
<p>输出示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">main.o: main.c defs.h</span></span><br></pre></td></tr></table></figure>
<p>对于 GNU 编译器，<code>-MM</code> 参数会忽略标准库头文件，仅生成用户头文件的依赖关系。</p>
<p>为了将这些自动生成的依赖关系集成到 Makefile 中，我们可以创建一个模式规则来生成 <code>.d</code> 文件。这些 <code>.d</code> 文件将存储每个源文件的依赖关系。例如：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">%.d: %.c</span></span><br><span class="line">    @set -e; rm -f <span class="variable">$@</span>; \</span><br><span class="line">    <span class="variable">$(CC)</span> -M <span class="variable">$(CPPFLAGS)</span> <span class="variable">$&lt;</span> &gt; <span class="variable">$@</span>.$$$$; \</span><br><span class="line">    sed &#x27;s,\(<span class="variable">$*</span>\)\.o[ :]*,\1.o <span class="variable">$@</span> : ,g&#x27; &lt; <span class="variable">$@</span>.$$$$ &gt; <span class="variable">$@</span>; \</span><br><span class="line">    rm -f <span class="variable">$@</span>.$$$$</span><br></pre></td></tr></table></figure>
<p>这个规则的工作流程如下：</p>
<ol>
<li class="lvl-3">
<p>删除旧的 <code>.d</code> 文件。</p>
</li>
<li class="lvl-3">
<p>使用编译器生成新的依赖文件。</p>
</li>
<li class="lvl-3">
<p>使用 <code>sed</code> 命令将生成的依赖关系格式化成 <code>.d</code> 文件的格式。</p>
</li>
<li class="lvl-3">
<p>删除临时文件。</p>
</li>
</ol>
<p>将 <code>.d</code> 文件集成到主 Makefile 中，可以通过 <code>include</code> 指令引入这些文件：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">sources = foo.c bar.c</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> $(sources:.c=.d)</span><br></pre></td></tr></table></figure>
<p>这里，<code>$(sources:.c=.d)</code> 会将 <code>foo.c</code> 和 <code>bar.c</code> 替换为 <code>foo.d</code> 和 <code>bar.d</code>。这样，主 Makefile 会自动包含每个 <code>.d</code> 文件，确保所有依赖关系得到更新。</p>
<h2 id="使用变量">使用变量</h2>
<p>在Makefile中，变量类似于C/C<ins>中的宏，用于代表文本字符串。在执行Makefile时，这些变量会自动展开。与C/C</ins>不同的是，你可以在Makefile中修改变量的值。变量可以在“目标”、“依赖目标”、“命令”或Makefile的其他部分中使用。</p>
<h3 id="变量的命名">变量的命名</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>可以包含字符、数字和下划线（下划线可以在数字开头），但不应包含 <code>:</code>、<code>#</code>、<code>=</code> 或空字符（空格、回车等）。</p>
</li>
<li class="lvl-2">
<p>变量名是大小写敏感的。例如，<code>foo</code>、<code>Foo</code> 和 <code>FOO</code> 是不同的变量名。</p>
</li>
<li class="lvl-2">
<p>推荐使用大小写搭配的变量名，如 <code>MakeFlags</code>，以避免与系统变量冲突。</p>
</li>
</ul>
<h3 id="变量的基础">变量的基础</h3>
<p><strong>定义和使用变量</strong>：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>定义变量：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">variable = value</span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p>使用变量：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(variable)</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">$&#123;variable&#125;</span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p>如果需要在变量中使用 <code>$</code> 字符，需用 <code>$$</code> 表示。</p>
</li>
</ul>
<h3 id="变量中的变量">变量中的变量</h3>
<p><strong>使用其他变量定义变量</strong>：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>简单使用 <code>=</code>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">foo = <span class="variable">$(bar)</span></span><br><span class="line">bar = <span class="variable">$(ugh)</span></span><br><span class="line">ugh = Huh?</span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">    echo <span class="variable">$(foo)</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p>使用 <code>:=</code> 进行即时展开：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">x := foo</span><br><span class="line">y := <span class="variable">$(x)</span> bar</span><br><span class="line">x := later</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="递归定义和即时展开">递归定义和即时展开</h3>
<p><strong>递归定义（不推荐）</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">CFLAGS = <span class="variable">$(CFLAGS)</span> -O</span><br></pre></td></tr></table></figure>
<p><strong>即时展开（推荐）</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">CFLAGS := <span class="variable">$(include_dirs)</span> -O</span><br><span class="line">include_dirs := -Ifoo -Ibar</span><br></pre></td></tr></table></figure>
<h3 id="其他变量操作">其他变量操作</h3>
<p><strong>定义空格变量</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">nullstring :=</span><br><span class="line">space := <span class="variable">$(nullstring)</span> <span class="comment"># end of the line</span></span><br></pre></td></tr></table></figure>
<p><strong>条件赋值</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">FOO ?= bar</span><br></pre></td></tr></table></figure>
<h3 id="高级用法">高级用法</h3>
<p><strong>变量值替换</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">foo := a.o b.o c.o</span><br><span class="line">bar := $(foo:.o=.c)</span><br></pre></td></tr></table></figure>
<p><strong>模式替换</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">foo := a.o b.o c.o</span><br><span class="line">bar := $(foo:%.o=%.c)</span><br></pre></td></tr></table></figure>
<p><strong>变量的值再当作变量</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">x = y</span><br><span class="line">y = z</span><br><span class="line">a := $(<span class="variable">$(x)</span>)</span><br></pre></td></tr></table></figure>
<p><strong>复杂示例</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">x = variable1</span><br><span class="line">variable2 := Hello</span><br><span class="line">y = <span class="variable">$(<span class="built_in">subst</span> 1,2,<span class="variable">$(x)</span>)</span></span><br><span class="line">z = y</span><br><span class="line">a := $($(<span class="variable">$(z)</span>))</span><br></pre></td></tr></table></figure>
<h3 id="追加变量值">追加变量值</h3>
<p><strong>使用 <code>+=</code> 追加值</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects = main.o foo.o bar.o utils.o</span><br><span class="line">objects += another.o</span><br></pre></td></tr></table></figure>
<h3 id="override-指令">override 指令</h3>
<p><strong>覆盖命令行或环境变量</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> variable := value</span><br></pre></td></tr></table></figure>
<h3 id="多行变量">多行变量</h3>
<p><strong>使用 <code>define</code> 定义多行变量</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">define</span> two-lines</span><br><span class="line">echo foo</span><br><span class="line">echo <span class="variable">$(bar)</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>
<h3 id="环境变量">环境变量</h3>
<p><strong>使用系统环境变量</strong>：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>如果定义了系统环境变量，则在Makefile中也可以使用。</p>
</li>
<li class="lvl-2">
<p>使用 <code>-e</code> 参数可以让环境变量覆盖Makefile中的变量。</p>
</li>
</ul>
<h3 id="目标变量">目标变量</h3>
<p><strong>定义目标特定变量</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">prog : CFLAGS = -g</span><br><span class="line">prog : prog.o foo.o bar.o</span><br><span class="line">    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> prog.o foo.o bar.o</span><br></pre></td></tr></table></figure>
<h3 id="模式变量">模式变量</h3>
<p><strong>定义模式特定变量</strong>：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">%.o : CFLAGS = -O</span><br></pre></td></tr></table></figure>
<h2 id="使用条件判断">使用条件判断</h2>
<p>在 <code>Makefile</code> 中，条件判断允许根据运行时的不同情况选择不同的执行分支。这是实现更复杂的构建逻辑时非常有用的功能。以下是有关如何在 <code>Makefile</code> 中使用条件判断的说明。</p>
<p>以下示例演示了如何根据 <code>$(CC)</code> 变量的值来选择不同的编译选项：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">libs_for_gcc = -lgnu</span><br><span class="line">normal_libs =</span><br><span class="line"></span><br><span class="line"><span class="section">foo: <span class="variable">$(objects)</span></span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CC)</span>,gcc)</span><br><span class="line">    <span class="variable">$(CC)</span> -o foo <span class="variable">$(objects)</span> <span class="variable">$(libs_for_gcc)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="variable">$(CC)</span> -o foo <span class="variable">$(objects)</span> <span class="variable">$(normal_libs)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，如果 <code>$(CC)</code> 的值是 <code>gcc</code>，则会将 <code>$(libs_for_gcc)</code> 作为库文件来编译目标 <code>foo</code>。否则，会使用 <code>$(normal_libs)</code> 作为库文件。</p>
<h3 id="语法-2">语法</h3>
<p>条件表达式的语法如下：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">&lt;conditional-directive&gt;</span><br><span class="line">&lt;text-if-true&gt;</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">&lt;conditional-directive&gt;</span><br><span class="line">&lt;text-if-true&gt;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&lt;text-if-false&gt;</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>其中 <code>&lt;conditional-directive&gt;</code> 是条件关键字。主要有以下四种：</p>
<ol>
<li class="lvl-3">
<p><strong><code>ifeq</code></strong>: 比较两个参数的值是否相同。</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (&lt;arg1&gt;, &lt;arg2&gt;)</span><br><span class="line"><span class="keyword">ifeq</span> &#x27;&lt;arg1&gt;&#x27; &#x27;&lt;arg2&gt;&#x27;</span><br><span class="line"><span class="keyword">ifeq</span> <span class="string">&quot;&lt;arg1&gt;&quot;</span> <span class="string">&quot;&lt;arg2&gt;&quot;</span></span><br><span class="line"><span class="keyword">ifeq</span> <span class="string">&quot;&lt;arg1&gt;&quot;</span> &#x27;&lt;arg2&gt;&#x27;</span><br><span class="line"><span class="keyword">ifeq</span> &#x27;&lt;arg1&gt;&#x27; <span class="string">&quot;&lt;arg2&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">strip</span> <span class="variable">$(foo)</span>)</span>,)</span><br><span class="line">&lt;text-if-empty&gt;</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p><strong><code>ifneq</code></strong>: 比较两个参数的值是否不同。</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (&lt;arg1&gt;, &lt;arg2&gt;)</span><br><span class="line"><span class="keyword">ifneq</span> &#x27;&lt;arg1&gt;&#x27; &#x27;&lt;arg2&gt;&#x27;</span><br><span class="line"><span class="keyword">ifneq</span> <span class="string">&quot;&lt;arg1&gt;&quot;</span> <span class="string">&quot;&lt;arg2&gt;&quot;</span></span><br><span class="line"><span class="keyword">ifneq</span> <span class="string">&quot;&lt;arg1&gt;&quot;</span> &#x27;&lt;arg2&gt;&#x27;</span><br><span class="line"><span class="keyword">ifneq</span> &#x27;&lt;arg1&gt;&#x27; <span class="string">&quot;&lt;arg2&gt;&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p><strong><code>ifdef</code></strong>: 检查一个变量是否被定义且值非空。</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ifdef</span> &lt;variable-name&gt;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">bar =</span><br><span class="line">foo = <span class="variable">$(bar)</span></span><br><span class="line"><span class="keyword">ifdef</span> foo</span><br><span class="line">    frobozz = yes</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    frobozz = no</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p><strong><code>ifndef</code></strong>: 检查一个变量是否未定义或值为空。</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ifndef</span> &lt;variable-name&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="注意事项">注意事项</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>在 <code>&lt;conditional-directive&gt;</code> 行上，多余的空格是允许的，但不能以 <code>Tab</code> 键开始。</p>
</li>
<li class="lvl-2">
<p>注释符 <code>#</code> 也是安全的。</p>
</li>
<li class="lvl-2">
<p><code>make</code> 在读取 <code>Makefile</code> 时计算条件表达式的值，所以最好不要将自动化变量（如 <code>$@</code>）放入条件表达式中，因为这些变量在运行时才会被定义。</p>
</li>
<li class="lvl-2">
<p><code>make</code> 不允许将条件语句分成两个部分放在不同的文件中。</p>
</li>
</ul>
<p>在 <code>Makefile</code> 中使用函数可以让你的构建规则更加灵活和智能。<code>make</code> 支持一些基本的函数，用于处理变量和字符串。以下是 <code>make</code> 中的主要函数及其用法的详细整理：</p>
<h2 id="使用函数">使用函数</h2>
<h3 id="函数调用语法">函数调用语法</h3>
<p>函数调用的基本语法是：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$&lt;</span>function&gt;(&lt;arguments&gt;)</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">$&#123;&lt;function&gt;(&lt;arguments&gt;)&#125;</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>&lt;function&gt;</code> 是函数名</p>
</li>
<li class="lvl-2">
<p><code>&lt;arguments&gt;</code> 是函数参数，参数间以逗号分隔</p>
</li>
</ul>
<h3 id="字符串处理函数">字符串处理函数</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>subst</code></strong>: 字符串替换</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">subst</span> &lt;from&gt;,&lt;to&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>替换 <code>&lt;text&gt;</code> 中的 <code>&lt;from&gt;</code> 为 <code>&lt;to&gt;</code>。例如：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">subst</span> ee,EE,feet on the street)</span>  <span class="comment"># 结果: fEEt on the strEEt</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>patsubst</code></strong>: 模式匹配替换</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>按模式 <code>&lt;pattern&gt;</code> 替换 <code>&lt;text&gt;</code> 中的部分。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> %.c,%.o,x.c.c bar.c)</span>  <span class="comment"># 结果: x.c.o bar.o</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>strip</code></strong>: 去除首尾空格</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">strip</span> &lt;string&gt;)</span></span><br></pre></td></tr></table></figure>
<p>去除 <code>&lt;string&gt;</code> 开头和结尾的空格。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">strip</span> a b c )</span>  <span class="comment"># 结果: a b c</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>findstring</code></strong>: 查找子串</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">findstring</span> &lt;find&gt;,&lt;in&gt;)</span></span><br></pre></td></tr></table></figure>
<p>查找 <code>&lt;in&gt;</code> 中是否存在 <code>&lt;find&gt;</code>。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">findstring</span> a,a b c)</span>  <span class="comment"># 结果: a</span></span><br><span class="line"><span class="variable">$(<span class="built_in">findstring</span> a,b c)</span>    <span class="comment"># 结果: （空）</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>filter</code></strong>: 按模式过滤</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">filter</span> &lt;pattern...&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>过滤 <code>&lt;text&gt;</code> 中符合 <code>&lt;pattern&gt;</code> 的单词。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">sources := foo.c bar.c baz.s ugh.h</span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %.c %.s,<span class="variable">$(sources)</span>)</span>  <span class="comment"># 结果: foo.c bar.c baz.s</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>filter-out</code></strong>: 反过滤</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">filter</span>-out &lt;pattern...&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>去除 <code>&lt;text&gt;</code> 中符合 <code>&lt;pattern&gt;</code> 的单词。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects=main1.o foo.o main2.o bar.o</span><br><span class="line">mains=main1.o main2.o</span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span>-out <span class="variable">$(mains)</span>,<span class="variable">$(objects)</span>)</span>  <span class="comment"># 结果: foo.o bar.o</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>sort</code></strong>: 排序</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">sort</span> &lt;list&gt;)</span></span><br></pre></td></tr></table></figure>
<p>对 <code>&lt;list&gt;</code> 中的单词进行升序排序。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">sort</span> foo bar lose)</span>  <span class="comment"># 结果: bar foo lose</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>word</code></strong>: 取单词</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">word</span> &lt;n&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>获取 <code>&lt;text&gt;</code> 中第 <code>&lt;n&gt;</code> 个单词。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">word</span> 2, foo bar baz)</span>  <span class="comment"># 结果: bar</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>wordlist</code></strong>: 取单词串</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">wordlist</span> &lt;ss&gt;,&lt;e&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>取 <code>&lt;text&gt;</code> 中从第 <code>&lt;ss&gt;</code> 到第 <code>&lt;e&gt;</code> 个单词。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">wordlist</span> 2, 3, foo bar baz)</span>  <span class="comment"># 结果: bar baz</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>words</code></strong>: 单词个数</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(words &lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>统计 <code>&lt;text&gt;</code> 中的单词数量。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(words foo bar baz)</span>  <span class="comment"># 结果: 3</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>firstword</code></strong>: 取首单词</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">firstword</span> &lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>取 <code>&lt;text&gt;</code> 中的第一个单词。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">firstword</span> foo bar)</span>  <span class="comment"># 结果: foo</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="文件名操作函数">文件名操作函数</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>dir</code></strong>: 取目录</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">dir</span> &lt;names...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>提取 <code>&lt;names&gt;</code> 中的目录部分。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">dir</span> src/foo.c hacks)</span>  <span class="comment"># 结果: src/ ./</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>notdir</code></strong>: 取文件名</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">notdir</span> &lt;names...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>提取 <code>&lt;names&gt;</code> 中的文件名部分。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">notdir</span> src/foo.c hacks)</span>  <span class="comment"># 结果: foo.c hacks</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>suffix</code></strong>: 取后缀</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">suffix</span> &lt;names...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>提取 <code>&lt;names&gt;</code> 中的文件后缀。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">suffix</span> src/foo.c src-1.0/bar.c hacks)</span>  <span class="comment"># 结果: .c .c</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>basename</code></strong>: 取前缀</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">basename</span> &lt;names...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>提取 <code>&lt;names&gt;</code> 中的文件前缀。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">basename</span> src/foo.c src-1.0/bar.c hacks)</span>  <span class="comment"># 结果: src/foo src-1.0/bar hacks</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>addsuffix</code></strong>: 添加后缀</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">addsuffix</span> &lt;<span class="built_in">suffix</span>&gt;,&lt;names...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>为 <code>&lt;names&gt;</code> 中的每个文件名添加 <code>&lt;suffix&gt;</code>。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">addsuffix</span> .c,foo bar)</span>  <span class="comment"># 结果: foo.c bar.c</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>addprefix</code></strong>: 添加前缀</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">addprefix</span> &lt;prefix&gt;,&lt;names...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>为 <code>&lt;names&gt;</code> 中的每个文件名添加 <code>&lt;prefix&gt;</code>。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">addprefix</span> src/,foo bar)</span>  <span class="comment"># 结果: src/foo src/bar</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>join</code></strong>: 连接</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">join</span> &lt;list1&gt;,&lt;list2&gt;)</span></span><br></pre></td></tr></table></figure>
<p>将 <code>&lt;list2&gt;</code> 中的单词连接到 <code>&lt;list1&gt;</code> 的每个单词后面。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">join</span> aaa bbb , 111 222 333)</span>  <span class="comment"># 结果: aaa111 bbb222 333</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="控制-make的函数">控制 make的函数</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>error</code></strong>: 报错并终止</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">error</span> &lt;text ...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>输出错误信息并停止执行。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">error</span> An <span class="built_in">error</span> occurred!)</span>  <span class="comment"># 输出错误并终止</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>warning</code></strong>: 警告</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">warning</span> &lt;text ...&gt;)</span></span><br></pre></td></tr></table></figure>
<p>输出警告信息但不终止执行。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">warning</span> This is a <span class="built_in">warning</span>!)</span>  <span class="comment"># 输出警告</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="其他函数">其他函数</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>call</code></strong>: 创建参数化函数</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">call</span> &lt;expression&gt;,&lt;parm1&gt;,&lt;parm2&gt;,...,&lt;parmn&gt;)</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>&lt;expression&gt;</code> 和参数 <code>&lt;parm1&gt;</code>, <code>&lt;parm2&gt;</code>, … 创建新的字符串。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">reverse = $(2) $(1)</span><br><span class="line">foo = <span class="variable">$(<span class="built_in">call</span> reverse,a,b)</span>  <span class="comment"># 结果: b a</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>origin</code></strong>: 获取变量来源</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">origin</span> &lt;variable&gt;)</span></span><br></pre></td></tr></table></figure>
<p>返回 <code>&lt;variable&gt;</code> 的来源类型。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">origin</span> CC)</span>  <span class="comment"># 结果: default</span></span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><strong><code>shell</code></strong>: 执行 Shell 命令</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">shell</span> &lt;command&gt;)</span></span><br></pre></td></tr></table></figure>
<p>执行 <code>&lt;command&gt;</code> 并返回其输出。示例：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">shell</span> ls)</span>  <span class="comment"># 执行 &#x27;ls&#x27; 命令并返回结果</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="make的运行">make的运行</h2>
<h3 id="make的退出码">make的退出码</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>0</strong>: 成功执行</p>
</li>
<li class="lvl-2">
<p><strong>1</strong>: 执行过程中出现错误</p>
</li>
<li class="lvl-2">
<p><strong>2</strong>: 使用了 <code>-q</code> 选项且某些目标不需要更新</p>
</li>
</ul>
<h3 id="指定-Makefile">指定 Makefile</h3>
<p>默认情况下，<code>make</code> 会查找当前目录下的 <code>GNUmakefile</code>、<code>makefile</code> 或 <code>Makefile</code>。你可以使用 <code>-f</code> 或 <code>--file</code> 参数来指定其他 Makefile。例如：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">make -f hchen.mk</span><br></pre></td></tr></table></figure>
<p>如果指定多个 <code>-f</code> 参数，<code>make</code> 会按顺序读取所有指定的 Makefile。</p>
<h3 id="指定目标">指定目标</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>默认情况下，<code>make</code> 执行第一个目标。你可以指定其他目标，例如：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<p><code>MAKECMDGOALS</code> 环境变量包含指定的终极目标列表，如果没有指定目标，该变量为空。</p>
</li>
</ul>
<h3 id="检查规则">检查规则</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>-n</code>, <code>--just-print</code>, <code>--dry-run</code>, <code>--recon</code></strong>: 不执行命令，只打印出命令序列。</p>
</li>
<li class="lvl-2">
<p><strong><code>-t</code>, <code>--touch</code></strong>: 更新目标文件的时间戳，但不真正编译。</p>
</li>
<li class="lvl-2">
<p><strong><code>-q</code>, <code>--question</code></strong>: 检查目标是否需要更新，不执行命令。</p>
</li>
<li class="lvl-2">
<p><strong><code>-W &lt;file&gt;</code>, <code>--what-if=&lt;file&gt;</code>, <code>--assume-new=&lt;file&gt;</code>, <code>--new-file=&lt;file&gt;</code></strong>: 假定指定的文件需要更新，常与 <code>-n</code> 参数结合使用。</p>
</li>
</ul>
<h3 id="make的常用参数">make的常用参数</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>-b</code>, <code>-m</code></strong>: 忽略与其他版本 <code>make</code> 的兼容性。</p>
</li>
<li class="lvl-2">
<p><strong><code>-B</code>, <code>--always-make</code></strong>: 认为所有目标都需要更新。</p>
</li>
<li class="lvl-2">
<p><strong><code>-C &lt;dir&gt;</code>, <code>--directory=&lt;dir&gt;</code></strong>: 指定 Makefile 所在目录。</p>
</li>
<li class="lvl-2">
<p><strong><code>-d</code></strong>: 输出调试信息，相当于 <code>--debug=a</code>。</p>
</li>
<li class="lvl-2">
<p><strong><code>-e</code>, <code>--environment-overrides</code></strong>: 环境变量值覆盖 Makefile 中的变量值。</p>
</li>
<li class="lvl-2">
<p><strong><code>-f &lt;file&gt;</code>, <code>--file=&lt;file&gt;</code>, <code>--makefile=&lt;file&gt;</code></strong>: 指定需要执行的 Makefile。</p>
</li>
<li class="lvl-2">
<p><strong><code>-i</code>, <code>--ignore-errors</code></strong>: 执行时忽略所有错误。</p>
</li>
<li class="lvl-2">
<p><strong><code>-I &lt;dir&gt;</code>, <code>--include-dir=&lt;dir&gt;</code></strong>: 指定包含 Makefile 的搜索目录。</p>
</li>
<li class="lvl-2">
<p><strong><code>-j [&lt;jobsnum&gt;]</code>, <code>--jobs[=&lt;jobsnum&gt;]</code></strong>: 指定同时运行的命令数量。</p>
</li>
<li class="lvl-2">
<p><strong><code>-k</code>, <code>--keep-going</code></strong>: 出错时继续执行。</p>
</li>
<li class="lvl-2">
<p><strong><code>-l &lt;load&gt;</code>, <code>--load-average[=&lt;load&gt;]</code></strong>: 指定命令运行的负载。</p>
</li>
<li class="lvl-2">
<p><strong><code>-p</code>, <code>--print-data-base</code></strong>: 输出 Makefile 中的所有数据。</p>
</li>
<li class="lvl-2">
<p><strong><code>-r</code>, <code>--no-builtin-rules</code></strong>: 禁止使用隐含规则。</p>
</li>
<li class="lvl-2">
<p><strong><code>-s</code>, <code>--silent</code>, <code>--quiet</code></strong>: 运行时不输出命令。</p>
</li>
<li class="lvl-2">
<p><strong><code>-t</code>, <code>--touch</code></strong>: 使目标文件的时间戳更新。</p>
</li>
<li class="lvl-2">
<p><strong><code>-v</code>, <code>--version</code></strong>: 输出 <code>make</code> 程序的版本信息。</p>
</li>
<li class="lvl-2">
<p><strong><code>-w</code>, <code>--print-directory</code></strong>: 输出运行 Makefile 之前和之后的目录信息。</p>
</li>
<li class="lvl-2">
<p><strong><code>--warn-undefined-variables</code></strong>: 输出未定义变量的警告信息。</p>
</li>
</ul>
<h2 id="隐含规则">隐含规则</h2>
<h3 id="隐含规则概述">隐含规则概述</h3>
<p>隐含规则是 <code>make</code> 提供的一种机制，允许自动推导目标文件的生成规则，而无需显式地在 <code>Makefile</code> 中定义这些规则。它们是 <code>make</code> 内部预设的一些规则，用于处理常见的编译和构建任务。理解隐含规则可以帮助你简化 <code>Makefile</code>，避免重复的规则定义。</p>
<h3 id="隐含规则的基本使用">隐含规则的基本使用</h3>
<p>当你在 <code>Makefile</code> 中只定义了目标和最终的依赖目标而没有明确列出如何生成依赖目标的规则时，<code>make</code> 会自动根据隐含规则来生成这些依赖目标。例如，在下述 <code>Makefile</code> 中：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">foo: foo.o bar.o</span></span><br><span class="line">    cc -o foo foo.o bar.o <span class="variable">$(CFLAGS)</span> <span class="variable">$(LDFLAGS)</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>Makefile</code> 中没有定义 <code>foo.o</code> 和 <code>bar.o</code> 的生成规则。<code>make</code> 会自动推导出这些目标的规则，通常是通过隐含规则将 <code>.c</code> 文件编译为 <code>.o</code> 文件。</p>
<h3 id="隐含规则的默认行为">隐含规则的默认行为</h3>
<p><code>make</code> 内部有一套默认的隐含规则，这些规则处理各种文件后缀的编译和转换。例如：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>编译 C 程序</strong>：<code>&lt;n&gt;.o</code> 的目标依赖于 <code>&lt;n&gt;.c</code> 文件，使用 <code>$(CC) -c $(CPPFLAGS) $(CFLAGS)</code> 命令生成目标文件。</p>
</li>
<li class="lvl-2">
<p><strong>编译 C++ 程序</strong>：<code>&lt;n&gt;.o</code> 的目标依赖于 <code>&lt;n&gt;.cc</code>、<code>&lt;n&gt;.cpp</code> 或 <code>&lt;n&gt;.C</code> 文件，使用 <code>$(CXX) -c $(CPPFLAGS) $(CXXFLAGS)</code> 命令生成目标文件。</p>
</li>
<li class="lvl-2">
<p><strong>编译 Fortran 程序</strong>：<code>&lt;n&gt;.o</code> 的目标依赖于 <code>&lt;n&gt;.f</code>、<code>&lt;n&gt;.F</code> 或 <code>&lt;n&gt;.r</code> 文件，使用相应的 Fortran 编译器命令生成目标文件。</p>
</li>
</ul>
<p>这些规则可以通过 <code>-r</code> 或 <code>--no-builtin-rules</code> 选项被禁用，但某些规则可能仍会根据后缀列表（如 <code>.o</code>、<code>.c</code>）生效。</p>
<h3 id="使用模式规则定义隐含规则">使用模式规则定义隐含规则</h3>
<p>你可以自定义隐含规则，使用模式规则定义规则的模式，其中 <code>％</code> 表示匹配文件名的一部分。例如：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">%.o: %.c</span></span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> <span class="variable">$(CPPFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>这个规则的意义是，任何 <code>.o</code> 文件的生成都依赖于同名的 <code>.c</code> 文件，并且会使用指定的编译命令生成目标文件。<code>$@</code> 表示目标文件，<code>$&lt;</code> 表示第一个依赖文件。</p>
<h3 id="自动化变量">自动化变量</h3>
<p>自动化变量用于在规则中表示特定的文件名和文件集合。这些变量可以帮助你编写通用的规则，处理不同的目标和依赖文件。常见的自动化变量包括：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>$@</code></strong>：表示规则中的目标文件。</p>
</li>
<li class="lvl-2">
<p><strong><code>$&lt;</code></strong>：表示第一个依赖文件。</p>
</li>
<li class="lvl-2">
<p><strong><code>$^</code></strong>：表示所有的依赖文件（去重）。</p>
</li>
<li class="lvl-2">
<p><strong><code>$*</code></strong>：表示目标文件名中模式中 <code>％</code> 及其之前的部分部分。</p>
</li>
</ul>
<h3 id="隐含规则链">隐含规则链</h3>
<p>隐含规则链指的是一个目标的生成可能依赖于多个隐含规则的组合。例如，<code>make</code> 可能会先使用 Yacc 隐含规则将 <code>.y</code> 文件转换为 <code>.c</code> 文件，然后再使用 C 编译的隐含规则将 <code>.c</code> 文件编译为 <code>.o</code> 文件。</p>
<h3 id="伪目标和特殊规则">伪目标和特殊规则</h3>
<p>你可以使用伪目标来控制 <code>make</code> 的行为，例如：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong><code>.INTERMEDIATE</code></strong>：声明中间目标，<code>make</code> 在生成最终目标后会删除这些中间文件。</p>
</li>
<li class="lvl-2">
<p><strong><code>.SECONDARY</code></strong>：声明中间目标，<code>make</code> 不会自动删除这些文件。</p>
</li>
<li class="lvl-2">
<p><strong><code>.PRECIOUS</code></strong>：声明被隐含规则生成的中间文件不会被删除。</p>
</li>
</ul>
<p>这些伪目标帮助你控制文件的生成和删除行为，以适应不同的构建需求。</p>
<p>通过理解和利用隐含规则、模式规则及自动化变量，你可以使 <code>Makefile</code> 更加简洁和高效，同时减少手动维护规则的复杂性。</p>
<h2 id="使用make更新函数库文件">使用make更新函数库文件</h2>
<ol>
<li class="lvl-3">
<p><strong>函数库文件（归档文件）</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5">由多个对象文件（.o 文件）组成。</li>
<li class="lvl-5">使用 <code>ar</code> 命令打包，例如 <code>ar cr libfoo.a foo.o</code>。</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>函数库文件的成员定义</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5">可以使用 <code>archive(member)</code> 的形式指定成员。</li>
<li class="lvl-5">多个成员用空格分开，或使用通配符来定义，如 <code>foolib(*.o)</code>。</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>隐含规则</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5"><code>make</code> 会将 <code>a(m)</code> 形式的目标变成 <code>m</code>，然后寻找对应的规则。</li>
<li class="lvl-5">例如，<code>make foo.a(bar.o)</code> 会尝试生成 <code>bar.o</code>，如果没有规则，<code>make</code> 会使用内建规则来编译 <code>bar.c</code> 生成 <code>bar.o</code>。</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>自动化变量</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5"><code>$%</code> 是函数库文件的自动化变量。</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>后缀规则</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5">使用 <code>.c.a</code> 后缀规则来生成归档文件。</li>
<li class="lvl-5">后缀规则的等效形式也可以使用隐含规则。</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>注意事项</strong>：</p>
<ul class="lvl-2">
<li class="lvl-5">并行执行（<code>-j</code> 参数）时要小心，因为多个 <code>ar</code> 命令可能会损坏归档文件。</li>
</ul>
</li>
</ol>
<h2 id="Reference">Reference</h2>
<p>[1]	跟我一起写Makefile:<a target="_blank" rel="noopener external nofollow noreferrer" href="https://seisman.github.io/how-to-write-makefile/index.html">https://seisman.github.io/how-to-write-makefile/index.html</a></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">推荐文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\archives\7762eb42.html" rel="bookmark">GCC&Gdb基础教程</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\archives\29207ea7.html" rel="bookmark">Git入门教程</a></div>
    </li>
  </ul>
<div class="post-widgets">
    <div
      class="social-share"
      
        data-sites="weibo,qq,wechat,douban,qzone,facebook,twitter"
      
      
        data-wechat-qrcode-title="share.title"
      
      
        data-wechat-qrcode-helper="share.prompt"
      
    >
    </div>
  </div>
  <script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js"></script><div>
    
        <div style="text-align:center;color: #ccc;font-size:20px;">
            ------------------------------- 本文结束啦❤<i class="fa fa-heart-o"></i>感谢您阅读-------------------------------
     </div>
    
</div>
        <div class="reward-container">
  <div>赞赏一杯咖啡</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="白茶不雨 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="白茶不雨 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>白茶不雨
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://liuaoao.top/archives/d5c3c62.html" title="深入理解Makefile">https://liuaoao.top/archives/d5c3c62.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/makefile/" rel="tag"><i class="fa fa-tag"></i> makefile</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/7762eb42.html" rel="prev" title="GCC&Gdb基础教程">
      <i class="fa fa-chevron-left"></i> GCC&Gdb基础教程
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/73a6de26.html" rel="next" title="数据表示方式">
      数据表示方式 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Makefile-%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">Makefile 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E4%B8%8E%E9%93%BE%E6%8E%A5"><span class="nav-number">1.1.</span> <span class="nav-text">编译与链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Make%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">1.2.</span> <span class="nav-text">Make的作用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Makefile%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">Makefile介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Makefile%E5%86%85%E5%AE%B9"><span class="nav-number">2.1.</span> <span class="nav-text">Makefile内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Make%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="nav-number">2.2.</span> <span class="nav-text">Make的工作方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Makefile%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F"><span class="nav-number">2.3.</span> <span class="nav-text">Makefile中使用变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A9Make%E8%87%AA%E5%8A%A8%E6%8E%A8%E5%AF%BC"><span class="nav-number">2.4.</span> <span class="nav-text">让Make自动推导</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">2.4.1.</span> <span class="nav-text">隐式规则的工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8C%96%E5%90%8E%E7%9A%84-Makefile-%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.4.2.</span> <span class="nav-text">简化后的 Makefile 示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E7%A9%BA%E7%9B%AE%E5%BD%95%E7%9A%84%E8%A7%84%E5%88%99"><span class="nav-number">2.5.</span> <span class="nav-text">清空目录的规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E5%90%AB%E5%85%B6%E5%AE%83Makefile"><span class="nav-number">2.6.</span> <span class="nav-text">包含其它Makefile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BB%E6%89%BE%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84"><span class="nav-number">2.6.1.</span> <span class="nav-text">寻找文件的路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">2.6.2.</span> <span class="nav-text">错误处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FMAKEFILES"><span class="nav-number">2.7.</span> <span class="nav-text">环境变量MAKEFILES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Makefile%E6%96%87%E4%BB%B6%E5%90%8D"><span class="nav-number">2.8.</span> <span class="nav-text">Makefile文件名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%A6%E5%86%99%E8%A7%84%E5%88%99"><span class="nav-number">3.</span> <span class="nav-text">书写规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-number">3.2.</span> <span class="nav-text">通配符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%90%9C%E5%AF%BB"><span class="nav-number">3.3.</span> <span class="nav-text">文件搜寻</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E7%9B%AE%E6%A0%87"><span class="nav-number">3.4.</span> <span class="nav-text">伪目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%9B%AE%E6%A0%87"><span class="nav-number">3.5.</span> <span class="nav-text">多目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.6.</span> <span class="nav-text">静态模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BE%9D%E8%B5%96%E6%80%A7"><span class="nav-number">3.7.</span> <span class="nav-text">自动生成依赖性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F"><span class="nav-number">4.</span> <span class="nav-text">使用变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%91%BD%E5%90%8D"><span class="nav-number">4.1.</span> <span class="nav-text">变量的命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%9F%BA%E7%A1%80"><span class="nav-number">4.2.</span> <span class="nav-text">变量的基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F"><span class="nav-number">4.3.</span> <span class="nav-text">变量中的变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%92%E5%BD%92%E5%AE%9A%E4%B9%89%E5%92%8C%E5%8D%B3%E6%97%B6%E5%B1%95%E5%BC%80"><span class="nav-number">4.4.</span> <span class="nav-text">递归定义和即时展开</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%8F%98%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="nav-number">4.5.</span> <span class="nav-text">其他变量操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="nav-number">4.6.</span> <span class="nav-text">高级用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%BD%E5%8A%A0%E5%8F%98%E9%87%8F%E5%80%BC"><span class="nav-number">4.7.</span> <span class="nav-text">追加变量值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#override-%E6%8C%87%E4%BB%A4"><span class="nav-number">4.8.</span> <span class="nav-text">override 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A1%8C%E5%8F%98%E9%87%8F"><span class="nav-number">4.9.</span> <span class="nav-text">多行变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">4.10.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E5%8F%98%E9%87%8F"><span class="nav-number">4.11.</span> <span class="nav-text">目标变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%BC%8F%E5%8F%98%E9%87%8F"><span class="nav-number">4.12.</span> <span class="nav-text">模式变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-number">5.</span> <span class="nav-text">使用条件判断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="nav-number">5.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">5.2.</span> <span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">6.</span> <span class="nav-text">使用函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="nav-number">6.1.</span> <span class="nav-text">函数调用语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="nav-number">6.2.</span> <span class="nav-text">字符串处理函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="nav-number">6.3.</span> <span class="nav-text">文件名操作函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6-make%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">6.4.</span> <span class="nav-text">控制 make的函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="nav-number">6.5.</span> <span class="nav-text">其他函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#make%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="nav-number">7.</span> <span class="nav-text">make的运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#make%E7%9A%84%E9%80%80%E5%87%BA%E7%A0%81"><span class="nav-number">7.1.</span> <span class="nav-text">make的退出码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-Makefile"><span class="nav-number">7.2.</span> <span class="nav-text">指定 Makefile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E7%9B%AE%E6%A0%87"><span class="nav-number">7.3.</span> <span class="nav-text">指定目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E8%A7%84%E5%88%99"><span class="nav-number">7.4.</span> <span class="nav-text">检查规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#make%E7%9A%84%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="nav-number">7.5.</span> <span class="nav-text">make的常用参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99"><span class="nav-number">8.</span> <span class="nav-text">隐含规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99%E6%A6%82%E8%BF%B0"><span class="nav-number">8.1.</span> <span class="nav-text">隐含规则概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">8.2.</span> <span class="nav-text">隐含规则的基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99%E7%9A%84%E9%BB%98%E8%AE%A4%E8%A1%8C%E4%B8%BA"><span class="nav-number">8.3.</span> <span class="nav-text">隐含规则的默认行为</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%BC%8F%E8%A7%84%E5%88%99%E5%AE%9A%E4%B9%89%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99"><span class="nav-number">8.4.</span> <span class="nav-text">使用模式规则定义隐含规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%98%E9%87%8F"><span class="nav-number">8.5.</span> <span class="nav-text">自动化变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99%E9%93%BE"><span class="nav-number">8.6.</span> <span class="nav-text">隐含规则链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E7%9B%AE%E6%A0%87%E5%92%8C%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99"><span class="nav-number">8.7.</span> <span class="nav-text">伪目标和特殊规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8make%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0%E5%BA%93%E6%96%87%E4%BB%B6"><span class="nav-number">9.</span> <span class="nav-text">使用make更新函数库文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">10.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="白茶不雨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">白茶不雨</p>
  <div class="site-description" itemprop="description">种一棵树最好的时间是十年前，其次是现在！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Humble-LiuAo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Humble-LiuAo" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1743185682@qq.com" title="E-Mail → mailto:1743185682@qq.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>



  <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
  <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
  <div class="widget-wrap">
    <div id="myCanvasContainer" class="widget tagcloud">
      <canvas width="250" height="250" id="resCanvas" style="width:100%">
        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Anaconda/" rel="tag">Anaconda</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/" rel="tag">CMD</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-mining/" rel="tag">Data mining</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GCC/" rel="tag">GCC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gdb/" rel="tag">Gdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jupyter/" rel="tag">Jupyter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LaTeX/" rel="tag">LaTeX</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lambda/" rel="tag">Lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-learning/" rel="tag">Machine learning</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/" rel="tag">Node.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSI/" rel="tag">OSI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pr/" rel="tag">Pr</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Proxy/" rel="tag">Proxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ps/" rel="tag">Ps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyCharm/" rel="tag">PyCharm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP&#x2F;IP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UTF-8/" rel="tag">UTF-8</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/" rel="tag">VSCode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/" rel="tag">Vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile/" rel="tag">makefile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" rel="tag">二进制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag">内网穿透</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%97%E8%A1%A8/" rel="tag">初始化列表</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92/" rel="tag">参数传递</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A6%E5%80%BC%E4%B8%8E%E5%8F%B3%E5%80%BC/" rel="tag">左值与右值</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">并发编程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">数组</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/" rel="tag">时间复杂度</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" rel="tag">构造函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/" rel="tag">析构函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%AE%E7%82%B9%E6%95%B0/" rel="tag">浮点数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/" rel="tag">空间复杂度</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E4%B9%89%E5%88%86%E6%9E%90/" rel="tag">语义分析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/" rel="tag">运算符</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8/" rel="tag">链表</a><span class="tag-list-count">1</span></li></ul>
      </canvas>
    </div>
  </div>




<div style="">
  <canvas id="canvas" style="width:80%; height:80%">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>

<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=86 src="//music.163.com/outchain/player?type=2&id=430685732&auto=0&height=66"></iframe>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">白茶不雨</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">190k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:52</span>
</div><!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>  When you want to give up，remember why you started！
<script>
	var now = new Date();
	function createtime() {
		var grt= new Date("03/07/2023 00:00:00");//此处修改你的建站时间或者网站上线时间
		now.setTime(now.getTime()+250);
		days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
		hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
		if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
		mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
		seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
		snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
		document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
		document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
}
setInterval("createtime()",250);
</script>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://liuaoao.top/archives/d5c3c62.html',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'hpWRbFYPjuqQOOWegUU9wApt-gzGzoHsz',
      appKey     : 'ijVoqxTEPQ3UW87ZGimvY741',
      placeholder: "有什么问题，欢迎留言指正与交流...",
      avatar     : 'retro',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>


  <script async src="/js/cursor/fireworks.js"></script>




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>






    </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":5,"vOffset":120},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
